!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);let r="undefined"!=typeof Float64Array?Float64Array:Array;Math.random;const i=Math.PI/180;function o(){let t=new r(2);return t[0]=0,t[1]=0,t}!function(){let t=o()}();function a(){let t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t}function s(t,e,n){let i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i}function l(t,e){let n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}!function(){let t=a()}();function h(){let t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u(t,e,n,r,o,a,s,l){const h=o[0]/o[1];let u=n*Math.tan(e*i/2);let c=2*u,f=h*c,d=-f/2;l&&(d+=l.x*f/o[0],u-=l.y*c/o[1],f*=l.width/o[0],c*=l.height/o[1]);const _=d+f,g=u-c,v=2*n/(_-d),y=(_+d)/(_-d),m=(u+g)/(u-g),b=2*n/(u-g),A=-(r+n)/(r-n),p=-2*r*n/(r-n);let M=0,w=0,S=s[0]-a[0],T=s[1]-a[1],x=s[2]-a[2],P=S*S+T*T+x*x;if(P>0){const t=1/Math.sqrt(P);S*=t,T*=t,x*=t}if(P=T*T+S*S,P>0){const t=1/Math.sqrt(P);M=-T*t,w=S*t}const R=-x*w,F=x*M,E=S*w-T*M,U=-(M*s[0]+w*s[1]),L=-(R*s[0]+F*s[1]+E*s[2]),C=-(S*s[0]+T*s[1]+x*s[2]);return t[0]=v*M+y*S,t[1]=b*R+m*S,t[2]=A*S,t[3]=-S,t[4]=v*w+y*T,t[5]=b*F+m*T,t[6]=A*T,t[7]=-T,t[8]=y*x,t[9]=b*E+m*x,t[10]=A*x,t[11]=-x,t[12]=v*U+y*C,t[13]=b*L+m*C,t[14]=A*C+p,t[15]=-C,t}var c={fov:60,near:1e3,far:Math.pow(2,34),minCalculationScreenHeight:1e3,hidePointObjectsAtPitch:30,viewportLimitRatio:2};!function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a]}(["s_transport"],["s_subway_exit","s_subway_exit_on_floor"]);function f(t,e,n){return t=Math.max(t,e),t=Math.min(t,n)}function d(t){return t*Math.PI/180}function _(t,e){var n=e.center,r=e.rotation,i=e.zoom,o=e.pitch,a=function(t,e){return b(e[1])*A/(512*Math.tan(d(c.fov)/2)*Math.pow(2,t))}(i,e.size),s=Math.max(a*Math.sin(o),1);t[0]=n[0]+Math.sin(r)*s,t[1]=n[1]-Math.cos(r)*s,t[2]=a*Math.cos(o)}g=h();var g,v=h(),y=a();!function(){var t=h()}();function m(t,e,n,r,i){void 0===n&&(n=c.near),void 0===r&&(r=c.far);var o=e.center,a=e.size,s=c.fov;_(y,e);var l=b(a[1]),h=void 0!==i?i:{x:0,y:0,width:a[0],height:a[1]};h.y+=(l-a[1])/2,u(t,s,n,r,[a[0],l],o,y,h)}function b(t){return Math.max(t,c.minCalculationScreenHeight)}"undefined"!=typeof requestIdleCallback&&requestIdleCallback;o(),o();var A=Math.pow(2,32);Math.pow(2,20);function p(t){var e=A/2,n=Math.sin(d(t[1])),r=t[0]*A/360,i=Math.log((1+n)/(1-n))*A/(4*Math.PI);return s(f(r,-e,e),f(i,-e,e),0)}const M=Math.pow(2,-52),w=new Uint32Array(512);class S{static from(t,e=L,n=C){const r=t.length,i=new Float64Array(2*r);for(let o=0;o<r;o++){const r=t[o];i[2*o]=e(r),i[2*o+1]=n(r)}return new S(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:r,_hullHash:i}=this,o=t.length>>1;let a=1/0,s=1/0,l=-1/0,h=-1/0;for(let e=0;e<o;e++){const n=t[2*e],r=t[2*e+1];n<a&&(a=n),r<s&&(s=r),n>l&&(l=n),r>h&&(h=r),this._ids[e]=e}const u=(a+l)/2,c=(s+h)/2;let f,d,_,g=1/0;for(let e=0;e<o;e++){const n=T(u,c,t[2*e],t[2*e+1]);n<g&&(f=e,g=n)}const v=t[2*f],y=t[2*f+1];g=1/0;for(let e=0;e<o;e++){if(e===f)continue;const n=T(v,y,t[2*e],t[2*e+1]);n<g&&n>0&&(d=e,g=n)}let m=t[2*d],b=t[2*d+1],A=1/0;for(let e=0;e<o;e++){if(e===f||e===d)continue;const n=F(v,y,m,b,t[2*e],t[2*e+1]);n<A&&(_=e,A=n)}let p=t[2*_],w=t[2*_+1];if(A===1/0){for(let e=0;e<o;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];E(this._ids,this._dists,0,o-1);const e=new Uint32Array(o);let n=0;for(let t=0,r=-1/0;t<o;t++){const i=this._ids[t];this._dists[i]>r&&(e[n++]=i,r=this._dists[i])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(P(v,y,m,b,p,w)){const t=d,e=m,n=b;d=_,m=p,b=w,_=t,p=e,w=n}const S=function(t,e,n,r,i,o){const a=n-t,s=r-e,l=i-t,h=o-e,u=a*a+s*s,c=l*l+h*h,f=.5/(a*h-s*l);return{x:t+(h*u-s*c)*f,y:e+(a*c-l*u)*f}}(v,y,m,b,p,w);this._cx=S.x,this._cy=S.y;for(let e=0;e<o;e++)this._dists[e]=T(t[2*e],t[2*e+1],S.x,S.y);E(this._ids,this._dists,0,o-1),this._hullStart=f;let x=3;n[f]=e[_]=d,n[d]=e[f]=_,n[_]=e[d]=f,r[f]=0,r[d]=1,r[_]=2,i.fill(-1),i[this._hashKey(v,y)]=f,i[this._hashKey(m,b)]=d,i[this._hashKey(p,w)]=_,this.trianglesLen=0,this._addTriangle(f,d,_,-1,-1,-1);for(let o,a,s=0;s<this._ids.length;s++){const l=this._ids[s],h=t[2*l],u=t[2*l+1];if(s>0&&Math.abs(h-o)<=M&&Math.abs(u-a)<=M)continue;if(o=h,a=u,l===f||l===d||l===_)continue;let c=0;for(let t=0,e=this._hashKey(h,u);t<this._hashSize&&(c=i[(e+t)%this._hashSize],-1===c||c===n[c]);t++);c=e[c];let g,v=c;for(;g=n[v],!P(h,u,t[2*v],t[2*v+1],t[2*g],t[2*g+1]);)if(v=g,v===c){v=-1;break}if(-1===v)continue;let y=this._addTriangle(v,l,n[v],-1,-1,r[v]);r[l]=this._legalize(y+2),r[v]=y,x++;let m=n[v];for(;g=n[m],P(h,u,t[2*m],t[2*m+1],t[2*g],t[2*g+1]);)y=this._addTriangle(m,l,g,r[l],-1,r[m]),r[l]=this._legalize(y+2),n[m]=m,x--,m=g;if(v===c)for(;g=e[v],P(h,u,t[2*g],t[2*g+1],t[2*v],t[2*v+1]);)y=this._addTriangle(g,l,v,-1,r[v],r[g]),this._legalize(y+2),r[g]=y,n[v]=v,x--,v=g;this._hullStart=e[l]=v,n[v]=e[m]=l,n[l]=m,i[this._hashKey(h,u)]=l,i[this._hashKey(t[2*v],t[2*v+1])]=v}this.hull=new Uint32Array(x);for(let t=0,e=this._hullStart;t<x;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:r}=this;let i=0,o=0;for(;;){const a=n[t],s=t-t%3;if(o=s+(t+2)%3,-1===a){if(0===i)break;t=w[--i];continue}const l=a-a%3,h=s+(t+1)%3,u=l+(a+2)%3,c=e[o],f=e[t],d=e[h],_=e[u];if(R(r[2*c],r[2*c+1],r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*_],r[2*_+1])){e[t]=_,e[a]=c;const r=n[u];if(-1===r){let e=this._hullStart;do{if(this._hullTri[e]===u){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,r),this._link(a,n[o]),this._link(o,u);const s=l+(a+1)%3;i<w.length&&(w[i++]=s)}else{if(0===i)break;t=w[--i]}}return o}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,r,i,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=e,this._triangles[a+2]=n,this._link(a,r),this._link(a+1,i),this._link(a+2,o),this.trianglesLen+=3,a}}function T(t,e,n,r){const i=t-n,o=e-r;return i*i+o*o}function x(t,e,n,r,i,o){const a=(r-e)*(i-t),s=(n-t)*(o-e);return Math.abs(a-s)>=33306690738754716e-32*Math.abs(a+s)?a-s:0}function P(t,e,n,r,i,o){return(x(i,o,t,e,n,r)||x(t,e,n,r,i,o)||x(n,r,i,o,t,e))<0}function R(t,e,n,r,i,o,a,s){const l=t-a,h=e-s,u=n-a,c=r-s,f=i-a,d=o-s,_=u*u+c*c,g=f*f+d*d;return l*(c*g-_*d)-h*(u*g-_*f)+(l*l+h*h)*(u*d-c*f)<0}function F(t,e,n,r,i,o){const a=n-t,s=r-e,l=i-t,h=o-e,u=a*a+s*s,c=l*l+h*h,f=.5/(a*h-s*l),d=(h*u-s*c)*f,_=(a*c-l*u)*f;return d*d+_*_}function E(t,e,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=t[i],o=e[r];let a=i-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let i=n+1,o=r;U(t,n+r>>1,i),e[t[n]]>e[t[r]]&&U(t,n,r),e[t[i]]>e[t[r]]&&U(t,i,r),e[t[n]]>e[t[i]]&&U(t,n,i);const a=t[i],s=e[a];for(;;){do{i++}while(e[t[i]]<s);do{o--}while(e[t[o]]>s);if(o<i)break;U(t,i,o)}t[n+1]=t[o],t[o]=a,r-i+1>=o-n?(E(t,e,i,r),E(t,e,n,o-1)):(E(t,e,n,o-1),E(t,e,i,r))}}function U(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function L(t){return t[0]}function C(t){return t[1]}function I(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}var k=window.map=new mapgl.Map("map",{center:[37.62017,55.753466],zoom:11,key:"042b5b75-f847-4f2a-b695-b5f58adc9dfd",zoomControl:!1}),z=document.getElementById("canvas"),B=z.getContext("webgl",{antialias:!1,premultipliedAlpha:!1,alpha:!0}),O=window.innerWidth,j=window.innerHeight;z.width=O,z.height=j,B.viewport(0,0,O,j);var q=B.createShader(B.VERTEX_SHADER),H=B.createShader(B.FRAGMENT_SHADER);B.shaderSource(q,"\n    attribute vec3 a_position;\n    attribute vec3 a_color;\n    uniform mat4 u_model;\n    varying vec3 v_color;\n\n    void main(void) {\n        v_color = a_color;\n        gl_Position = u_model * vec4(a_position, 1.0);\n    }\n"),B.shaderSource(H,"\n    precision mediump float;\n    varying vec3 v_color;\n\n    void main(void) {\n        gl_FragColor = vec4(v_color.rgb, 0.7);\n    }\n"),B.compileShader(q),B.compileShader(H),B.getShaderParameter(q,B.COMPILE_STATUS)||console.log(B.getShaderInfoLog(q)),B.getShaderParameter(H,B.COMPILE_STATUS)||console.log(B.getShaderInfoLog(H));var K=B.createProgram();B.attachShader(K,q),B.attachShader(K,H),B.linkProgram(K),B.getProgramParameter(K,B.LINK_STATUS)||console.log("Could not initialize shaders");var D={aPosition:B.getAttribLocation(K,"a_position"),aColor:B.getAttribLocation(K,"a_color"),uModel:B.getUniformLocation(K,"u_model")},N=B.createBuffer(),Y=B.createBuffer(),V=[p([37.53468263266983,55.8057898485786]),p([37.73449647407034,55.680559093862406])];fetch("./data.csv").then((function(t){return t.text()})).then((function(t){var e=t.split("\n").slice(1).map((function(t){return t.split(",").map(Number)}));e.forEach((function(t){var e=p([t[0],t[1]]);t[0]=e[0],t[1]=e[1]})),e=e.filter((function(t){return t[0]>V[0][0]&&t[0]<V[1][0]&&t[1]>V[1][1]&&t[1]<V[0][1]}));for(var n=S.from(e),r=[],i=0;i<e.length;i++)r.push(e[i][2]);r.sort((function(t,e){return t-e}));var o=r[Math.floor(.9*r.length)],a=r[0],s=[],l=[];n.triangles.forEach((function(t){var n=e[t][2],r=Math.min(n-a,o-a)/(o-a),i=function(t,e,n){if(0===e)return[n,n,n];t/=360;var r=n<.5?n*(1+e):n+e-n*e,i=2*n-r;return[Math.round(255*I(i,r,t+1/3)),Math.round(255*I(i,r,t)),Math.round(255*I(i,r,t-1/3))]}(100-Math.round(function(t,e,n){return t+n*(e-t)}(0,100,r)),1,.5).map((function(t){return t/255})),h=i[0],u=i[1],c=i[2];s.push(h,u,c),l.push(e[t][0],e[t][1],2e5*r)})),console.log(l),B.bindBuffer(B.ARRAY_BUFFER,N),B.bufferData(B.ARRAY_BUFFER,new Float32Array(l),B.STATIC_DRAW),B.bindBuffer(B.ARRAY_BUFFER,Y),B.bufferData(B.ARRAY_BUFFER,new Float32Array(s),B.STATIC_DRAW),requestAnimationFrame((function t(){requestAnimationFrame(t),B.useProgram(K),B.uniformMatrix4fv(D.uModel,!1,k._impl.modules.renderer.vpMatrix),B.enable(B.DEPTH_TEST),B.depthFunc(B.LESS),B.bindBuffer(B.ARRAY_BUFFER,Y),B.enableVertexAttribArray(D.aColor),B.vertexAttribPointer(D.aColor,3,B.FLOAT,!1,0,0),B.bindBuffer(B.ARRAY_BUFFER,N),B.enableVertexAttribArray(D.aPosition),B.vertexAttribPointer(D.aPosition,3,B.FLOAT,!1,0,0),B.clearColor(1,1,1,0),B.clear(B.COLOR_BUFFER_BIT),B.drawArrays(B.TRIANGLES,0,l.length/3)}))}))}]);